# name: Deploy FastAPI via Docker Image

# on:
#   push:
#     branches: [ main ]

# jobs:
#   build-and-deploy:
#     runs-on: ubuntu-latest

#     steps:
#       - name: âœ… Checkout
#         uses: actions/checkout@v4

#       - name: ğŸ“ ë””ë²„ê¹… - í˜„ì¬ ë””ë ‰í† ë¦¬ ëª©ë¡ í™•ì¸
#         run: ls -al

#       - name: âœ… Docker ì´ë¯¸ì§€ ë¹Œë“œ
#         run: |
#           docker build -t fastapi-app -f Dockerfile .  # ğŸ”¥ contextë¥¼ ëª…í™•íˆ ì§€ì •
#           docker save fastapi-app > fastapi-app.tar

#       - name: âœ… ì´ë¯¸ì§€ EC2ë¡œ ì „ì†¡
#         uses: appleboy/scp-action@v0.1.4
#         with:
#           host: ${{ secrets.EC2_HOST }}
#           username: ${{ secrets.EC2_USERNAME }}
#           key: ${{ secrets.EC2_PRIVATE_KEY }}
#           source: "fastapi-app.tar"
#           target: "~/fastapi-deploy"

#       - name: âœ… EC2ì—ì„œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
#         uses: appleboy/ssh-action@v1.0.0
#         with:
#           host: ${{ secrets.EC2_HOST }}
#           username: ${{ secrets.EC2_USERNAME }}
#           key: ${{ secrets.EC2_PRIVATE_KEY }}
#           script: |
#             cd ~/fastapi-deploy
#             docker stop fastapi-container || true
#             docker rm fastapi-container || true
#             docker load < fastapi-app.tar
#             docker run -d --name fastapi-container -p 8088:8088 fastapi-app